-- 1. Create database
CREATE DATABASE IF NOT EXISTS event_planner_db;
USE event_planner_db;

-- 2. Users Table
CREATE TABLE IF NOT EXISTS users (
    id INT AUTO_INCREMENT PRIMARY KEY,
    name VARCHAR(100),
    email VARCHAR(100) UNIQUE,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- 3. Events Table
CREATE TABLE IF NOT EXISTS events (
    id INT AUTO_INCREMENT PRIMARY KEY,
    user_id INT,
    event_type VARCHAR(50),
    budget DECIMAL(10, 2),
    guest_count INT,
    location VARCHAR(100),
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE CASCADE
);

-- 4. Checklist Items Table
CREATE TABLE IF NOT EXISTS checklist_items (
    id INT AUTO_INCREMENT PRIMARY KEY,
    name VARCHAR(255),
    is_mandatory BOOLEAN DEFAULT FALSE
);

-- 5. Event Checklist Table (many-to-many between events and checklist items)
CREATE TABLE IF NOT EXISTS event_checklist (
    id INT AUTO_INCREMENT PRIMARY KEY,
    event_id INT,
    checklist_item_id INT,
    status ENUM('pending', 'completed') DEFAULT 'pending',
    FOREIGN KEY (event_id) REFERENCES events(id) ON DELETE CASCADE,
    FOREIGN KEY (checklist_item_id) REFERENCES checklist_items(id) ON DELETE CASCADE
);

-- 6. Rules Table (logic engine rule definitions)
CREATE TABLE IF NOT EXISTS rules (
    id INT AUTO_INCREMENT PRIMARY KEY,
    rule_name VARCHAR(255),
    condition_json JSON,
    actions_json JSON,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- 7. Rule Logs Table (track rule applications)
CREATE TABLE IF NOT EXISTS rule_logs (
    id INT AUTO_INCREMENT PRIMARY KEY,
    event_id INT,
    rule_id INT,
    applied_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (event_id) REFERENCES events(id) ON DELETE CASCADE,
    FOREIGN KEY (rule_id) REFERENCES rules(id) ON DELETE CASCADE
);

-- 8. Sample Rule Insertion (Optional Example)
INSERT INTO rules (rule_name, condition_json, actions_json) VALUES
(
  'Wedding Basic Checklist',
  '{"event_type":"wedding"}',
  '[
    "Add \'Book wedding venue\'",
    "Add \'Hire photographer\'",
    "Add \'Send invitations\'",
    "Add \'Plan wedding dress and attire\'"
  ]'
),
(
  'Budget Constraint Checklist',
  '{"budget":{"lte":5000}}',
  '[
    "Add \'Use low-cost venue options\'",
    "Add \'Use DIY decorations\'",
    "Remove \'Luxury catering services\'"
  ]'
);